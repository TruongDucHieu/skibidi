<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·ª£ l√Ω Y t·∫ø AI - Tra c·ª©u thu·ªëc</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .main-button {
            transition: all 0.3s ease;
        }
        .main-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .view {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 20px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .user-bubble {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        .ai-bubble {
            background-color: #e9ecef;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* CSS ƒë·ªÉ ƒë·ªãnh d·∫°ng k·∫øt qu·∫£ tra c·ª©u khoa h·ªçc v√† ƒë·∫πp m·∫Øt h∆°n */
        .lookup-result-content h1 {
            font-size: 1.75rem; /* 28px */
            font-weight: 700;
            color: #1e40af; /* Tailwind blue-800 */
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb; /* Tailwind gray-200 */
            padding-bottom: 0.5rem;
        }
        .lookup-result-content h2 {
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: #1d4ed8; /* Tailwind blue-700 */
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .lookup-result-content ul {
            list-style-type: disc;
            padding-left: 1.75rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .lookup-result-content li {
            margin-bottom: 0.5rem;
        }
        .lookup-result-content strong {
            color: #1f2937; /* Tailwind gray-800 */
            font-weight: 600;
        }
         .lookup-result-content p {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }
        /* Th√™m m·ªõi: CSS cho khu v·ª±c xem tr∆∞·ªõc nhi·ªÅu ·∫£nh */
        #image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        #image-preview-container img {
            max-height: 10rem; /* 160px */
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            object-fit: cover;
        }

        /* CSS cho c√°c emoji trang tr√≠ */
        .decorative-left, .decorative-right {
            position: fixed; /* Ho·∫∑c absolute n·∫øu mu·ªën cu·ªôn c√πng trang */
            top: 50%;
            transform: translateY(-50%);
            font-size: 4rem; /* K√≠ch th∆∞·ªõc emoji l·ªõn */
            opacity: 0.2; /* L√†m m·ªù ƒë·ªÉ kh√¥ng qu√° n·ªïi b·∫≠t */
            pointer-events: none; /* Kh√¥ng cho ph√©p t∆∞∆°ng t√°c v·ªõi chu·ªôt */
            z-index: -1; /* ƒê·∫∑t ra ph√≠a sau n·ªôi dung ch√≠nh */
        }
        .decorative-left {
            left: 20px; /* Kho·∫£ng c√°ch t·ª´ l·ªÅ tr√°i */
        }
        .decorative-right {
            right: 20px; /* Kho·∫£ng c√°ch t·ª´ l·ªÅ ph·∫£i */
        }
        @media (max-width: 768px) {
            .decorative-left, .decorative-right {
                display: none; /* ·∫®n ƒëi tr√™n m√†n h√¨nh nh·ªè */
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="decorative-left">üíä</div>
    <div class="decorative-right">üë®‚Äç‚öïÔ∏è</div>

    <div id="app" class="max-w-4xl mx-auto p-4 md:p-6 min-h-screen flex flex-col">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600">
                <span class="text-green-500">‚öïÔ∏è</span> Tr·ª£ l√Ω Y t·∫ø AI
            </h1>
            <p class="text-gray-500 mt-2">Tra c·ª©u thu·ªëc v√† t∆∞ v·∫•n s·ª©c kh·ªèe th√¥ng minh</p>
        </header>

        <div id="main-menu" class="view">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <button onclick="showView('text-lookup-view')" class="main-button bg-white p-8 rounded-2xl shadow-lg text-left hover:bg-blue-50">
                    <div class="text-4xl mb-4">üíä</div>
                    <h2 class="text-2xl font-bold text-blue-700">Tra c·ª©u th√¥ng tin thu·ªëc</h2>
                    <p class="text-gray-600 mt-2">Nh·∫≠p t√™n thu·ªëc ƒë·ªÉ xem chi ti·∫øt c√¥ng d·ª•ng, li·ªÅu d√πng v√† l∆∞u √Ω.</p>
                </button>
                
                <button onclick="showView('ai-chat-view')" class="main-button bg-white p-8 rounded-2xl shadow-lg text-left hover:bg-green-50">
                    <div class="text-4xl mb-4">üë®‚Äç‚öïÔ∏è</div>
                    <h2 class="text-2xl font-bold text-green-700">Tr√≤ chuy·ªán v·ªõi B√°c sƒ© AI</h2>
                    <p class="text-gray-600 mt-2">H·ªèi ƒë√°p v·ªÅ c√°c tri·ªáu ch·ª©ng v√† nh·∫≠n l·ªùi khuy√™n s·ª©c kh·ªèe ban ƒë·∫ßu.</p>
                </button>

                <button onclick="showView('image-lookup-view')" class="main-button bg-white p-8 rounded-2xl shadow-lg text-left hover:bg-indigo-50">
                    <div class="text-4xl mb-4">üì∏</div>
                    <h2 class="text-2xl font-bold text-indigo-700">Tra c·ª©u b·∫±ng h√¨nh ·∫£nh</h2>
                    <p class="text-gray-600 mt-2">Ch·ª•p ·∫£nh h·ªôp thu·ªëc ƒë·ªÉ AI nh·∫≠n di·ªán v√† cung c·∫•p th√¥ng tin.</p>
                </button>

                <button onclick="showView('copyright-view')" class="main-button bg-white p-8 rounded-2xl shadow-lg text-left hover:bg-gray-100">
                    <div class="text-4xl mb-4">¬©Ô∏è</div>
                    <h2 class="text-2xl font-bold text-gray-700">B·∫£n quy·ªÅn</h2>
                    <p class="text-gray-600 mt-2">Th√¥ng tin v·ªÅ ƒë∆°n v·ªã ph√°t tri·ªÉn ·ª©ng d·ª•ng.</p>
                </button>
            </div>
        </div>

        <div id="text-lookup-view" class="view flex-grow flex flex-col">
            <button onclick="showView('main-menu')" class="mb-4 text-blue-600 hover:underline">&larr; Quay l·∫°i trang ch·ªß</button>
            <h2 class="text-3xl font-bold mb-4">üíä Tra c·ª©u th√¥ng tin thu·ªëc</h2>
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <input id="drug-name-input" type="text" placeholder="Nh·∫≠p t√™n thu·ªëc, v√≠ d·ª•: Paracetamol" class="flex-grow p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <button id="lookup-drug-btn" onclick="lookupDrug()" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300">
                    Tra c·ª©u
                </button>
            </div>
            <div id="text-lookup-result" class="bg-white p-6 rounded-lg shadow-inner flex-grow overflow-y-auto break-words lookup-result-content">
                <p class="text-gray-500">K·∫øt qu·∫£ tra c·ª©u s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</p>
            </div>
        </div>

        <div id="ai-chat-view" class="view flex-grow flex flex-col">
            <button onclick="showView('main-menu')" class="mb-4 text-green-600 hover:underline">&larr; Quay l·∫°i trang ch·ªß</button>
            <h2 class="text-3xl font-bold mb-4">üë®‚Äç‚öïÔ∏è Tr√≤ chuy·ªán v·ªõi B√°c sƒ© AI</h2>
            <div id="chat-window" class="flex-grow bg-white p-4 rounded-lg shadow-inner overflow-y-auto h-96 flex flex-col space-y-4 mb-4">
                <div class="chat-bubble ai-bubble">
                    Ch√†o b·∫°n! T√¥i l√† b√°c sƒ© AI, r·∫•t vui ƒë∆∞·ª£c tr√≤ chuy·ªán v√† l·∫Øng nghe b·∫°n. B·∫°n ƒëang c√≥ bƒÉn khoƒÉn hay v·∫•n ƒë·ªÅ s·ª©c kh·ªèe n√†o c·∫ßn t√¥i t∆∞ v·∫•n kh√¥ng? H√£y c·ª© tho·∫£i m√°i chia s·∫ª nh√©! T√¥i s·∫Ω c·ªë g·∫Øng h·∫øt s·ª©c ƒë·ªÉ ƒë∆∞a ra nh·ªØng l·ªùi khuy√™n h·ªØu √≠ch v√† d·ªÖ hi·ªÉu nh·∫•t cho b·∫°n. √Ä, b·∫°n nh·ªõ nh√©, nh·ªØng th√¥ng tin t√¥i chia s·∫ª ch·ªâ mang t√≠nh tham kh·∫£o th√¥i, n·∫øu c·∫ßn ch·∫©n ƒëo√°n ch√≠nh x√°c v√† ƒëi·ªÅu tr·ªã chuy√™n s√¢u, b·∫°n h√£y t√¨m g·∫∑p b√°c sƒ© chuy√™n khoa ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m tr·ª±c ti·∫øp nha!
                </div>
            </div>
            <div class="flex gap-4">
                <input id="chat-input" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." class="flex-grow p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none">
                <button id="send-chat-btn" onclick="sendChatMessage()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors duration-300">
                    G·ª≠i
                </button>
            </div>
        </div>

        <div id="image-lookup-view" class="view flex-grow flex flex-col">
            <button onclick="showView('main-menu')" class="mb-4 text-indigo-600 hover:underline">&larr; Quay l·∫°i trang ch·ªß</button>
            <h2 class="text-3xl font-bold mb-4">üì∏ Tra c·ª©u thu·ªëc b·∫±ng h√¨nh ·∫£nh</h2>
            <div class="bg-white p-6 rounded-lg shadow-inner mb-4 text-center">
                 <input type="file" id="image-upload-input" class="hidden" accept="image/*" onchange="previewImage(event)" multiple>
                 <label for="image-upload-input" class="cursor-pointer bg-indigo-100 text-indigo-700 font-semibold py-3 px-5 rounded-lg border-2 border-dashed border-indigo-300 hover:bg-indigo-200 transition-colors duration-300">
                     Ch·ªçn m·ªôt ho·∫∑c nhi·ªÅu ·∫£nh
                 </label>
                 <div id="image-preview-container"></div>
            </div>
            <button id="lookup-image-btn" onclick="lookupByImage()" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 disabled:bg-gray-400" disabled>
                Ph√¢n t√≠ch ·∫£nh
            </button>
            <div id="image-lookup-result" class="bg-white p-6 rounded-lg shadow-inner mt-4 flex-grow overflow-y-auto break-words lookup-result-content">
                 <p class="text-gray-500">K·∫øt qu·∫£ ph√¢n t√≠ch h√¨nh ·∫£nh s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</p>
            </div>
        </div>

        <div id="copyright-view" class="view text-center flex-grow flex flex-col justify-center items-center">
             <button onclick="showView('main-menu')" class="mb-4 text-gray-600 hover:underline">&larr; Quay l·∫°i trang ch·ªß</button>
            <div class="text-5xl mb-4">üìú</div>
            <h2 class="text-3xl font-bold mb-2">Th√¥ng tin b·∫£n quy·ªÅn</h2>
            <p class="text-gray-700 text-lg">·ª®ng d·ª•ng n√†y ƒë∆∞·ª£c ph√°t tri·ªÉn v√† gi·ªØ b·∫£n quy·ªÅn b·ªüi:</p>
            <p class="font-bold text-xl mt-4">Tr∆∞∆°ng ƒê·ª©c Hi·∫øu</p>
        </div>
    </div>

    <footer class="bg-black text-white text-center p-4 mt-8">
        <p>&copy; 2025 Tr·ª£ l√Ω Y t·∫ø AI. M·ªçi b·∫£n quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
    </footer>

    <script>
        // --- Configuration ---
        const API_KEY = "AIzaSyBNpyTvc92NOnO_08P_0ADTzIkIJcQg3wA"; // Leave blank, Canvas will handle it.
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
        
        // --- State Management ---
        let chatHistory = [
            {
                role: "user",
                parts: [{ text: "H√£y ƒë√≥ng vai l√† m·ªôt b√°c sƒ© t·∫≠n t√¢m, ch√¢n th·ª±c, th√¢n thi·ªán, vui v·∫ª v√† lu√¥n ƒë∆∞a ra nh·ªØng l·ªùi khuy√™n h·ªØu √≠ch nh∆∞ m·ªôt v·ªã b√°c sƒ© th·ª±c th·ª•. Khi b·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán, h√£y th·ªÉ hi·ªán s·ª± quan t√¢m v√† ch√†o h·ªèi m·ªôt c√°ch t·ª± nhi√™n. Lu√¥n nh·∫•n m·∫°nh r·∫±ng th√¥ng tin b·∫°n cung c·∫•p ch·ªâ mang t√≠nh tham kh·∫£o v√† ng∆∞·ªùi d√πng n√™n tham kh·∫£o √Ω ki·∫øn b√°c sƒ© chuy√™n khoa ƒë·ªÉ c√≥ ch·∫©n ƒëo√°n ch√≠nh x√°c. ƒê·ªìng th·ªùi, h√£y s·ª≠ d·ª•ng ng√¥n ng·ªØ t·ª± nhi√™n, g·∫ßn g≈©i, tr√°nh ng√¥n ng·ªØ qu√° m√°y m√≥c hay kh√¥ khan." }]
            },
            {
                role: "model",
                parts: [{ text: "Ch√†o b·∫°n! T√¥i l√† b√°c sƒ© AI, r·∫•t vui ƒë∆∞·ª£c tr√≤ chuy·ªán v√† l·∫Øng nghe b·∫°n. B·∫°n ƒëang c√≥ bƒÉn khoƒÉn hay v·∫•n ƒë·ªÅ s·ª©c kh·ªèe n√†o c·∫ßn t√¥i t∆∞ v·∫•n kh√¥ng? H√£y c·ª© tho·∫£i m√°i chia s·∫ª nh√©! T√¥i s·∫Ω c·ªë g·∫Øng h·∫øt s·ª©c ƒë·ªÉ ƒë∆∞a ra nh·ªØng l·ªùi khuy√™n h·ªØu √≠ch v√† d·ªÖ hi·ªÉu nh·∫•t cho b·∫°n. √Ä, b·∫°n nh·ªõ nh√©, nh·ªØng th√¥ng tin t√¥i chia s·∫ª ch·ªâ mang t√≠nh tham kh·∫£o th√¥i, n·∫øu c·∫ßn ch·∫©n ƒëo√°n ch√≠nh x√°c v√† ƒëi·ªÅu tr·ªã chuy√™n s√¢u, b·∫°n h√£y t√¨m g·∫∑p b√°c sƒ© chuy√™n khoa ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m tr·ª±c ti·∫øp nha!" }]
            }
        ];
        // S·ª≠a ƒë·ªïi: Chuy·ªÉn sang m·∫£ng ƒë·ªÉ l∆∞u nhi·ªÅu ·∫£nh
        let base64Images = [];

        // --- UI Control ---
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.style.display = 'none';
            });
            const viewToShow = document.getElementById(viewId);
            if (viewId === 'main-menu') {
                viewToShow.style.display = 'block';
            } else {
                viewToShow.style.display = 'flex';
            }
        }
        
        function showLoader(resultElementId) {
            const resultDiv = document.getElementById(resultElementId);
            resultDiv.innerHTML = '<div class="loader"></div><p class="text-center text-gray-500">AI ƒëang ph√¢n t√≠ch, vui l√≤ng ch·ªù trong gi√¢y l√°t...</p>';
        }

        function renderMarkdown(elementId, text) {
            const element = document.getElementById(elementId);
            element.innerHTML = marked.parse(text);
        }

        // --- API Call Logic ---
        async function callGemini(payload) {
             try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error:", errorData);
                    throw new Error(`API request failed: ${errorData.error.message}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0) {
                     return result.candidates[0].content.parts[0].text;
                } else {
                     throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ AI.");
                }
             } catch(error) {
                console.error("Fetch Error:", error);
                return `ƒê√£ x·∫£y ra l·ªói: ${error.message}. Vui l√≤ng th·ª≠ l·∫°i.`;
             }
        }
        
        // --- Feature 1: Text Lookup ---
        async function lookupDrug() {
            const drugName = document.getElementById('drug-name-input').value.trim();
            if (!drugName) {
                alert("Vui l√≤ng nh·∫≠p t√™n thu·ªëc.");
                return;
            }
            
            showLoader('text-lookup-result');
            const prompt = `Cung c·∫•p th√¥ng tin chi ti·∫øt v√† khoa h·ªçc v·ªÅ thu·ªëc "${drugName}" b·∫±ng ti·∫øng Vi·ªát. S·ª≠ d·ª•ng ƒë·ªãnh d·∫°ng Markdown sau ƒë√¢y m·ªôt c√°ch nghi√™m ng·∫∑t:

# üíä ${drugName}

## üìù Th√¥ng tin chung
* **Ho·∫°t ch·∫•t ch√≠nh:** [ƒêi·ªÅn ho·∫°t ch·∫•t]
* **Nh√≥m thu·ªëc:** [ƒêi·ªÅn nh√≥m thu·ªëc]
* **M√¥ t·∫£ ng·∫Øn:** [M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ thu·ªëc]

## ‚úÖ C√¥ng d·ª•ng
*Li·ªát k√™ c√°c c√¥ng d·ª•ng ch√≠nh c·ªßa thu·ªëc b·∫±ng c√°c g·∫°ch ƒë·∫ßu d√≤ng.*

## üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng
* **C√°ch d√πng:** [M√¥ t·∫£ c√°ch d√πng chi ti·∫øt]
* **Li·ªÅu l∆∞·ª£ng:**
    * **Ng∆∞·ªùi l·ªõn:** [Li·ªÅu cho ng∆∞·ªùi l·ªõn]
    * **Tr·∫ª em:** [Li·ªÅu cho tr·∫ª em, ghi r√µ ƒë·ªô tu·ªïi n·∫øu c√≥]

## üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ƒê·ªëi t∆∞·ª£ng s·ª≠ d·ª•ng
* **Ch·ªâ ƒë·ªãnh:** [C√°c tr∆∞·ªùng h·ª£p n√™n d√πng thu·ªëc]
* **Ch·ªëng ch·ªâ ƒë·ªãnh:** [C√°c tr∆∞·ªùng h·ª£p **kh√¥ng** ƒë∆∞·ª£c d√πng thu·ªëc]

## ‚ö†Ô∏è T√°c d·ª•ng ph·ª• v√† L∆∞u √Ω
* **T√°c d·ª•ng ph·ª• th∆∞·ªùng g·∫∑p:** [Li·ªát k√™]
* **T√°c d·ª•ng ph·ª• hi·∫øm g·∫∑p:** [Li·ªát k√™]
* **T∆∞∆°ng t√°c thu·ªëc:** [C√°c t∆∞∆°ng t√°c quan tr·ªçng c·∫ßn l∆∞u √Ω]
* **L∆∞u √Ω ƒë·∫∑c bi·ªát:** [V√≠ d·ª•: cho ph·ª• n·ªØ c√≥ thai, cho con b√∫, ng∆∞·ªùi gi√†, ng∆∞·ªùi c√≥ b·ªánh n·ªÅn...]`;
            
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            const resultText = await callGemini(payload);
            renderMarkdown('text-lookup-result', resultText);
        }

        // --- Feature 2: AI Chat ---
        async function sendChatMessage() {
            const userInput = document.getElementById('chat-input').value.trim();
            if (!userInput) return;

            const chatWindow = document.getElementById('chat-window');
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble user-bubble';
            userBubble.textContent = userInput;
            chatWindow.appendChild(userBubble);
            
            chatHistory.push({ role: "user", parts: [{ text: userInput }] });
            
            document.getElementById('chat-input').value = '';
            chatWindow.scrollTop = chatWindow.scrollHeight;

            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'chat-bubble ai-bubble';
            typingIndicator.innerHTML = '<span class="italic">B√°c sƒ© AI ƒëang so·∫°n tin...</span>';
            chatWindow.appendChild(typingIndicator);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            const payload = { contents: chatHistory };
            const aiResponseText = await callGemini(payload);
            
            chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });

            chatWindow.removeChild(typingIndicator);
            const aiBubble = document.createElement('div');
            aiBubble.className = 'chat-bubble ai-bubble';
            aiBubble.innerHTML = marked.parse(aiResponseText);
            chatWindow.appendChild(aiBubble);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
        
        // --- Feature 3: Image Lookup ---
        // S·ª≠a ƒë·ªïi: Vi·∫øt l·∫°i h√†m ƒë·ªÉ x·ª≠ l√Ω nhi·ªÅu ·∫£nh
        function previewImage(event) {
            const files = event.target.files;
            const imagePreviewContainer = document.getElementById('image-preview-container');
            const lookupBtn = document.getElementById('lookup-image-btn');

            // X√≥a tr·∫°ng th√°i c≈©
            imagePreviewContainer.innerHTML = '';
            base64Images = [];
            lookupBtn.disabled = true;

            if (files.length === 0) {
                return;
            }

            // X·ª≠ l√Ω t·ª´ng t·ªáp
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')){ return; }

                const reader = new FileReader();

                reader.onload = function(e) {
                    // T·∫°o ·∫£nh xem tr∆∞·ªõc
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    imagePreviewContainer.appendChild(img);

                    // L∆∞u d·ªØ li·ªáu base64 c√πng v·ªõi lo·∫°i mime
                    const base64Data = e.target.result.split(',')[1];
                    base64Images.push({
                        mime_type: file.type,
                        data: base64Data
                    });

                    // Ch·ªâ b·∫≠t n√∫t khi t·∫•t c·∫£ c√°c t·ªáp ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω
                    if (base64Images.length === files.length) {
                        lookupBtn.disabled = false;
                    }
                };

                reader.readAsDataURL(file);
            });
        }
        
        // S·ª≠a ƒë·ªïi: Vi·∫øt l·∫°i h√†m ƒë·ªÉ g·ª≠i nhi·ªÅu ·∫£nh ƒë·∫øn API
        async function lookupByImage() {
            if (base64Images.length === 0) {
                alert("Vui l√≤ng ch·ªçn m·ªôt ho·∫∑c nhi·ªÅu h√¨nh ·∫£nh tr∆∞·ªõc.");
                return;
            }

            showLoader('image-lookup-result');
            const prompt = `Ph√¢n t√≠ch c√°c h√¨nh ·∫£nh ƒë∆∞·ª£c cung c·∫•p. ƒê√¢y l√† h√¨nh ·∫£nh c·ªßa m·ªôt ho·∫∑c nhi·ªÅu lo·∫°i thu·ªëc (v√≠ d·ª•: ·∫£nh h·ªôp thu·ªëc, v·ªâ thu·ªëc, vi√™n thu·ªëc). H√£y:
1.  **X√°c ƒë·ªãnh** t√™n (c√°c) lo·∫°i thu·ªëc t·ª´ t·∫•t c·∫£ c√°c h√¨nh ·∫£nh.
2.  **T·ªïng h·ª£p** th√¥ng tin t·ª´ t·∫•t c·∫£ c√°c ·∫£nh ƒë·ªÉ cung c·∫•p m·ªôt b√°o c√°o ƒë·∫ßy ƒë·ªß nh·∫•t.
3.  **Tr√¨nh b√†y** th√¥ng tin cho m·ªói lo·∫°i thu·ªëc t√¨m th·∫•y theo ƒë·ªãnh d·∫°ng Markdown khoa h·ªçc d∆∞·ªõi ƒë√¢y. N·∫øu c√≥ nhi·ªÅu lo·∫°i thu·ªëc, h√£y l·∫∑p l·∫°i c·∫•u tr√∫c n√†y cho t·ª´ng lo·∫°i.
4.  N·∫øu kh√¥ng th·ªÉ x√°c ƒë·ªãnh ƒë∆∞·ª£c b·∫•t k·ª≥ lo·∫°i thu·ªëc n√†o, h√£y th√¥ng b√°o r√µ r√†ng cho ng∆∞·ªùi d√πng.

---

# üíä (T√™n thu·ªëc ƒë√£ x√°c ƒë·ªãnh)

## üìù Th√¥ng tin chung
* **Ho·∫°t ch·∫•t ch√≠nh:** [ƒêi·ªÅn ho·∫°t ch·∫•t]
* **Nh√≥m thu·ªëc:** [ƒêi·ªÅn nh√≥m thu·ªëc]
* **M√¥ t·∫£ ng·∫Øn:** [M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ thu·ªëc]

## ‚úÖ C√¥ng d·ª•ng
*Li·ªát k√™ c√°c c√¥ng d·ª•ng ch√≠nh c·ªßa thu·ªëc b·∫±ng c√°c g·∫°ch ƒë·∫ßu d√≤ng.*

## üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng
* **C√°ch d√πng:** [M√¥ t·∫£ c√°ch d√πng chi ti·∫øt]
* **Li·ªÅu l∆∞·ª£ng:**
    * **Ng∆∞·ªùi l·ªõn:** [Li·ªÅu cho ng∆∞·ªùi l·ªõn]
    * **Tr·∫ª em:** [Li·ªÅu cho tr·∫ª em, ghi r√µ ƒë·ªô tu·ªïi n·∫øu c√≥]

## üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ƒê·ªëi t∆∞·ª£ng s·ª≠ d·ª•ng
* **Ch·ªâ ƒë·ªãnh:** [C√°c tr∆∞·ªùng h·ª£p n√™n d√πng thu·ªëc]
* **Ch·ªëng ch·ªâ ƒë·ªãnh:** [C√°c tr∆∞·ªùng h·ª£p **kh√¥ng** ƒë∆∞·ª£c d√πng thu·ªëc]

## ‚ö†Ô∏è T√°c d·ª•ng ph·ª• v√† L∆∞u √Ω
* **T√°c d·ª•ng ph·ª• th∆∞·ªùng g·∫∑p:** [Li·ªát k√™]
* **T√°c d·ª•ng ph·ª• hi·∫øm g·∫∑p:** [Li·ªát k√™]
* **T∆∞∆°ng t√°c thu·ªëc:** [C√°c t∆∞∆°ng t√°c quan tr·ªçng c·∫ßn l∆∞u √Ω]
* **L∆∞u √Ω ƒë·∫∑c bi·ªát:** [V√≠ d·ª•: cho ph·ª• n·ªØ c√≥ thai, cho con b√∫, ng∆∞·ªùi gi√†, ng∆∞·ªùi c√≥ b·ªánh n·ªÅn...]`;

            // X√¢y d·ª±ng c√°c ph·∫ßn c·ªßa payload
            const parts = [{ text: prompt }];
            base64Images.forEach(img => {
                parts.push({
                    inline_data: {
                        mime_type: img.mime_type,
                        data: img.data
                    }
                });
            });

            const payload = {
                contents: [{ parts: parts }]
            };

            const resultText = await callGemini(payload);
            renderMarkdown('image-lookup-result', resultText);
        }

        // Add keypress listeners for better UX
        document.getElementById('drug-name-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                lookupDrug();
            }
        });
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            showView('main-menu');
        });

    </script>
</body>
</html>
